<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Power-of-Two Inputs</title>
	<style>
		:root {
			--bg: #0f172a;
			--card: #111827;
			--accent: #38bdf8;
			--text: #e5e7eb;
			--muted: #94a3b8;
			--border: #1f2937;
		}

		* { box-sizing: border-box; }

		body {
			margin: 0;
			min-height: 100vh;
			display: grid;
			place-items: center;
			background: radial-gradient(circle at 20% 20%, rgba(56, 189, 248, 0.12), transparent 25%),
									radial-gradient(circle at 80% 30%, rgba(59, 130, 246, 0.12), transparent 28%),
									linear-gradient(135deg, #0b1221 0%, #0f172a 100%);
			color: var(--text);
			font-family: "Space Grotesk", "Sora", "Manrope", system-ui, -apple-system, sans-serif;
			padding: 32px;
		}

		.card {
			width: min(880px, 100%);
			background: var(--card);
			border: 1px solid var(--border);
			border-radius: 18px;
			padding: 32px;
			box-shadow: 0 15px 45px rgba(0, 0, 0, 0.35);
		}

		.header {
			display: flex;
			justify-content: space-between;
			align-items: baseline;
			gap: 12px;
			margin-bottom: 18px;
		}

		h1 {
			margin: 0;
			font-size: 1.6rem;
			letter-spacing: -0.03em;
		}

		p {
			margin: 0;
			color: var(--muted);
		}

		.slider-row {
			display: grid;
			grid-template-columns: 1fr auto;
			gap: 14px;
			align-items: center;
			margin: 18px 0 8px;
		}

		input[type="range"] {
			width: 100%;
			accent-color: var(--accent);
		}

		.value-pill {
			padding: 6px 12px;
			border-radius: 999px;
			background: rgba(56, 189, 248, 0.12);
			border: 1px solid var(--border);
			color: var(--accent);
			font-weight: 600;
			letter-spacing: 0.01em;
		}

		.inputs-grid {
			display: grid;
			grid-template-columns: repeat(4, minmax(0, 1fr));
			gap: 10px;
			margin-top: 14px;
		}

		.inputs-grid input[type="text"] {
			width: 100%;
			padding: 10px 12px;
			border-radius: 10px;
			border: 1px solid var(--border);
			background: #0c1323;
			color: var(--text);
			outline: none;
			transition: border-color 0.15s ease, box-shadow 0.15s ease;
		}

		.inputs-grid input[type="text"]:focus {
			border-color: var(--accent);
			box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.15);
		}

		.hint {
			margin-top: 8px;
			color: var(--muted);
			font-size: 0.9rem;
		}
	</style>
</head>
<body>
	<main class="card">
		<div class="header">
			<div>
				<h1>Infinite PPAP</h1>
			</div>
		</div>

		<div class="slider-row">
			<input id="powerSlider" type="range" min="0" max="6" step="1" value="0" aria-label="Power of two selector" />
			<span class="value-pill" id="valuePill">1</span>
		</div>

		<section class="inputs-grid" id="inputsGrid"></section>
		<button id="submitBtn" type="button" style="margin-top: 16px; padding: 10px 14px; border-radius: 10px; border: 1px solid var(--border); background: var(--accent); color: #0b1221; font-weight: 700; cursor: pointer;">Submit</button>
	</main>

	<script>
		const allowedValues = [1, 2, 4, 8, 16, 32, 64];
		const slider = document.getElementById('powerSlider');
		const valuePill = document.getElementById('valuePill');
		const inputsGrid = document.getElementById('inputsGrid');
		const submitBtn = document.getElementById('submitBtn');

		slider.max = allowedValues.length - 1;

		const renderInputs = (count) => {
			inputsGrid.innerHTML = '';
			for (let i = 0; i < count; i += 1) {
				const input = document.createElement('input');
				input.type = 'text';
				input.placeholder = `Box ${i + 1}`;
				inputsGrid.appendChild(input);
			}
		};

		const syncUI = (index) => {
			const value = allowedValues[index] ?? allowedValues[0];
			valuePill.textContent = value;
			renderInputs(value);
		};

		slider.addEventListener('input', () => {
			const index = Number(slider.value);
			syncUI(index);
		});

		const buildPPAPLyrics = (words) => {
			const clean = words.map((w) => w.trim()).filter(Boolean);

			// Ensure we have at least two items and pad to the next power of two.
			if (clean.length === 0) clean.push('pen', 'apple');
			if (clean.length === 1) clean.push(clean[0]);

			const target = (() => {
				let t = 1;
				while (t < clean.length) t *= 2;
				return Math.max(t, 2);
			})();
			while (clean.length < target) clean.push(clean[clean.length - 1]);

			const fmtRaw = (arr) => arr.join('-');
			const fmtOut = (arr) => {
				if (arr.length > 1 && arr.every((t) => t === arr[0])) {
					const parts = Array.from({ length: arr.length - 1 }, () => 'long');
					parts.push(arr[0]);
					return parts.join('-');
				}
				return fmtRaw(arr);
			};

			const swap = (arr) => {
				if (arr.length === 1) return arr;
				const half = arr.length / 2;
				const first = arr.slice(0, half);
				const second = arr.slice(half);
				// Per spec: swap(second) comes first, then the first half.
				return [...swap(second), ...first];
			};

			const lines = [];
			let current = clean.map((item) => [item]);

			while (current.length > 1) {
				const nextRound = [];
				for (let i = 0; i < current.length; i += 2) {
					const a = current[i];
					const b = current[i + 1];
					lines.push(`I have a ${fmtOut(a)}, I have a ${fmtOut(b)}.`);
					const combined = swap([...a, ...b]);
					lines.push(`Uh! ${fmtOut(combined)}!`);
					lines.push('');
					nextRound.push(combined);
				}
				current = nextRound;
			}

			lines.push(`${fmtOut(current[0])}!`);
			return lines.join('\n').replace(/\n$/, '');
		};

		submitBtn.addEventListener('click', () => {
			const values = Array.from(inputsGrid.querySelectorAll('input')).map((input) => input.value);
			const lyrics = buildPPAPLyrics(values);
			alert(lyrics);
		});

		// Initialize UI.
		syncUI(Number(slider.value));
	</script>
</body>
</html>
